<div class="dashboard">
  <nav class="sidebar">
    <div class="sidebar-header">
      <h2>Admin Portal</h2>
    </div>
    <ul class="nav-menu">
      <li>
        <a routerLink="/dashboard" routerLinkActive="active">
          <span>ğŸ“Š</span> Dashboard
        </a>
      </li>
      <li>
        <a routerLink="/users" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
          <span>ğŸ‘¥</span> Users
        </a>
      </li>
      <li>
        <a routerLink="/projects" routerLinkActive="active">
          <span>ğŸ“</span> Projects
        </a>
      </li>
      <li>
        <a routerLink="/api-tracking" routerLinkActive="active">
          <span>ğŸ“ˆ</span> API Tracking
        </a>
      </li>
    </ul>
    <div class="sidebar-footer">
      <button class="btn-logout" (click)="logout()">Logout</button>
    </div>
  </nav>

  <main class="main-content">
    <header class="page-header">
      <h1>User Management</h1>
      <button class="btn-primary" (click)="toggleCreateForm()">
        <span>â•</span> {{ showCreateForm ? 'Cancel' : 'Add New User' }}
      </button>
    </header>

    <div *ngIf="error" class="alert alert-error">{{ error }}</div>
    <div *ngIf="success" class="alert alert-success">{{ success }}</div>

    <!-- Create User Form -->
    <div class="card" *ngIf="showCreateForm">
      <h2>Create New User</h2>
      <form [formGroup]="createUserForm" (ngSubmit)="onSubmit()">
        <div class="form-grid">
          <div class="form-group">
            <label for="firstName">First Name *</label>
            <input
              type="text"
              id="firstName"
              formControlName="firstName"
              placeholder="Enter first name"
              [class.invalid]="createUserForm.get('firstName')?.invalid && createUserForm.get('firstName')?.touched"
            />
            <span class="error-message" *ngIf="createUserForm.get('firstName')?.invalid && createUserForm.get('firstName')?.touched">
              First name is required
            </span>
          </div>

          <div class="form-group">
            <label for="lastName">Last Name *</label>
            <input
              type="text"
              id="lastName"
              formControlName="lastName"
              placeholder="Enter last name"
              [class.invalid]="createUserForm.get('lastName')?.invalid && createUserForm.get('lastName')?.touched"
            />
            <span class="error-message" *ngIf="createUserForm.get('lastName')?.invalid && createUserForm.get('lastName')?.touched">
              Last name is required
            </span>
          </div>

          <div class="form-group">
            <label for="email">Email *</label>
            <input
              type="email"
              id="email"
              formControlName="email"
              placeholder="user@example.com"
              [class.invalid]="createUserForm.get('email')?.invalid && createUserForm.get('email')?.touched"
            />
            <span class="error-message" *ngIf="createUserForm.get('email')?.invalid && createUserForm.get('email')?.touched">
              Valid email is required
            </span>
          </div>

          <div class="form-group">
            <label for="password">Password *</label>
            <input
              type="password"
              id="password"
              formControlName="password"
              placeholder="Minimum 6 characters"
              [class.invalid]="createUserForm.get('password')?.invalid && createUserForm.get('password')?.touched"
            />
            <span class="error-message" *ngIf="createUserForm.get('password')?.invalid && createUserForm.get('password')?.touched">
              Password must be at least 6 characters
            </span>
          </div>
        </div>

        <div class="form-group">
          <label>Roles * (Select at least one)</label>
          <div class="checkbox-group">
            <label class="checkbox-label" *ngFor="let role of availableRoles">
              <input
                type="checkbox"
                [checked]="isRoleSelected(role.value)"
                (change)="onRoleChange($event, role.value)"
              />
              <span>{{ role.label }}</span>
            </label>
          </div>
          <span class="error-message" *ngIf="createUserForm.get('roles')?.invalid && createUserForm.get('roles')?.touched">
            At least one role is required
          </span>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="toggleCreateForm()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="createUserForm.invalid || loading">
            {{ loading ? 'Creating...' : 'Create User' }}
          </button>
        </div>
      </form>
    </div>

    <!-- Search and Filters -->
    <div class="card">
      <div class="search-bar">
        <input
          type="text"
          placeholder="Search users by name or email..."
          [(ngModel)]="searchTerm"
          (input)="searchUsers()"
        />
        <span class="search-icon">ğŸ”</span>
      </div>
    </div>

    <!-- Users List -->
    <div class="card">
      <div class="table-header">
        <h2>Users List</h2>
        <span class="count-badge">{{ filteredUsers.length }} users</span>
      </div>

      <div *ngIf="loading" class="loading">Loading users...</div>

      <div *ngIf="!loading && filteredUsers.length === 0" class="empty-state">
        <p>No users found</p>
      </div>

      <table *ngIf="!loading && filteredUsers.length > 0" class="users-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Roles</th>
            <th>Status</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of filteredUsers">
            <td>{{ user.firstName }} {{ user.lastName }}</td>
            <td>{{ user.email }}</td>
            <td>
              <span
                *ngFor="let role of user.roles"
                class="role-badge"
                [ngClass]="getRoleBadgeClass(user.roles)"
              >
                {{ role.replace('_', ' ') }}
              </span>
            </td>
            <td>
              <span class="status-badge" [class.status-active]="user.status === 'ACTIVE'" [class.status-inactive]="user.status !== 'ACTIVE'">
                {{ user.status }}
              </span>
            </td>
            <td>{{ user.createdAt | date:'short' }}</td>
            <td class="actions">
              <button
                class="btn-sm btn-warning"
                *ngIf="user.status === 'ACTIVE'"
                (click)="updateUserStatus(user, 'DISABLED')"
                title="Disable User"
              >
                Disable
              </button>
              <button
                class="btn-sm btn-success"
                *ngIf="user.status !== 'ACTIVE'"
                (click)="updateUserStatus(user, 'ACTIVE')"
                title="Enable User"
              >
                Enable
              </button>
              <button
                class="btn-sm btn-danger"
                (click)="deleteUser(user)"
                title="Delete User"
              >
                Delete
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>
</div>
